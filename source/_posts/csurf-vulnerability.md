---
title: The csurf vulnerability (from a dev-perspective)
author: Mauricio Matias C.
avatar: mauricio-matias.jpeg
description: The csurf library has insecure design issues. What can we do?
date: 2022-10-03
tags: [Security]
id: csurf-vulnerability
relatedPost: vue-security-best-practices
---

{% image_fw 1.78 "banner.png" "The csurf vulnerability" %}

The `csurf` library is one of the most popular libraries to carry out the task of CSRF protection in the Node ecosystem. The library has 400K downloads per month. So, it is part of many projects. But, it was discovered recently by Adrian Tiron from the Fortbridge Team (you can check out [his write-up](https://fortbridge.co.uk/research/a-csrf-vulnerability-in-the-popular-csurf-package/)). The library has several wrong designs and could be a counterintuitive library to protect us against CSRF attacks.

<!-- toc -->

Let's talk about it. It is well known that some developers base their judgment about the functionality of a library on the number of stars, downloads, or documentation, which in some cases means respect and trust. But it is possible to find some issues even if the library is famous and widely used.

## The library issues

OnÂ [dev-academy.com](http://dev-academy.com/), we encourage you to read theÂ Adrian Tiron [write-up](https://fortbridge.co.uk/research/a-csrf-vulnerability-in-the-popular-csurf-package/) to exploit and understand the vulnerability in depth. But we can keep his summary about the issues' library.

- Secret stored in clear text in the _csrf cookie
- sha1 is deprecated
- No signature checking for cookies by default
- It only validates the header token against the secret

Secrets are secrets! They never will be discovered by anyone and never be a part of a payload sent to the client (users).

sha1 was deprecate in 2011 (many years before). It was used until 2017 as an algorithm for digital signature purposes on browsers like Firefox and Chrome. So its use in 2022 is dangerous.

The rest of the issues reveals the library doesn't have the most accurate implementation of the "Double Submit Cookie" technique recommended by OWASP to fight against CSRF attacks (link [here](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#double-submit-cookie)). This technique is easy to implement and uses a stateless approach. In the [web security academy](https://websecurity-academy.com/), we have a detailed explanation of the CSRF attacks.

## The source code never lies

As a developer in a backend role, sometimes we delegate the weight of complex mechanisms implementation to popular libraries in the ecosystem. Maybe it resolves the problem and saves a lot of time, but in the process, we can introduce issues and vulnerabilities in our applications. So we have some recommendations (we mentioned some of them in [previous posts](https://dev-academy.com/vue-security-best-practices/)).

The packages are great! But, it has people behind it and needs more of them to create a good one, so the contribution is crucial. Every package could work well, but you don't take this as a source of truth (doubts and multidimensional perspectives are welcome in the contribution ecosystem ðŸ˜ƒ), and the popular package `csurf` is one of the multiple probes of it.

Check out the source code always if it is possible. Maybe take a little or more time than you have to implement functionality, but this practice is a good way to improve your skills and keep your system secure. A usual path for cyber-criminals to take advantage of each package ecosystem is when the dependency installation is underway or when the library wasn't bad designed intentionally.

## Then, what can I do?

In the case of the `csurf` package, the creator decided to deprecate this package, which means we need to search for alternatives or implement the "Double Submit Cookie" technique on our own. So we won't have new versions in the short term.

We have these recommendations for you:

- Implement one of the multiple techniques to mitigate the CSRF vector.
- Find an alternative library on NPM.
- Use this [PoC repository](https://github.com/cr0wg4n/node-anti-csrf) as a guide to replace the `csurf` library using the csrf-csrf library on NPM.

## Summary

We won't encourage you to untrust every little package could you have. But, the packages related to authentication, authorization, routing, and user input must be taken seriously.

Take this problem as a challenge to test libraries, form part of the contribution of a single one, and implement your super secure library!

Goodbye friends. Until another post ðŸ˜ƒ.

> There's no silver bullet!
